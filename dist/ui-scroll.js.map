{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/modules/jqLiteExtras.js","webpack:///./src/modules/elementRoutines.js","webpack:///./src/modules/buffer.js","webpack:///./src/modules/padding.js","webpack:///./src/modules/viewport.js","webpack:///./src/modules/adapter.js","webpack:///./src/ui-scroll.js"],"names":["JQLiteExtras","element","convertToPx","css","getStyle","isWindow","angular","prototype","name","value","self","elem","nodeType","style","call","obj","document","location","alert","setInterval","scrollTo","direction","top","left","method","prop","preserve","isValueDefined","documentElement","window","getComputedStyle","parseFloat","currentStyle","result","rs","rsLeft","core_pnum","source","rnumnonpx","RegExp","test","runtimeStyle","pixelLeft","getMeasurements","measure","base","borderA","borderB","computedMarginA","computedMarginB","computedStyle","dirA","dirB","marginA","marginB","paddingA","paddingB","height","width","padding","border","margin","offsetWidth","offsetHeight","getWidthHeight","measurements","outer","outerfull","forEach","before","newElem","children","i","j","parent","ref","contents","prepend","length","after","Error","outerHTML","isNumber","outerHeight","option","outerWidth","offset","docElem","win","box","doc","ownerDocument","arguments","undefined","getBoundingClientRect","defaultView","parentWindow","pageYOffset","scrollTop","clientTop","pageXOffset","scrollLeft","clientLeft","key","hideClassToken","ElementRoutines","selector","rules","sheet","styleSheets","index","cssRules","err","insertRule","addRule","$injector","$q","$animate","has","get","isAngularVersionLessThen1_3","version","major","minor","wrapper","addClass","removeClass","newElement","previousElement","remove","scope","$destroy","insertElement","deferred","defer","enter","resolve","promise","removeElement","leave","then","ScrollBuffer","elementRoutines","bufferSize","startIndex","rowHeight","buffer","Object","create","Array","extend","size","reset","eof","bof","first","next","minIndex","maxIndex","minIndexUser","maxIndexUser","resetStartIndex","append","items","item","insert","Math","max","reverse","min","operation","isTop","op","splice","push","unshift","arg1","arg2","indexOf","_op","getAbsMinIndex","incrementMinIndex","decrementMaxIndex","removeElementAnimated","getAbsMaxIndex","effectiveHeight","elements","Number","MAX_VALUE","bottom","NEGATIVE_INFINITY","offsetParent","getItems","filter","getFirstItem","list","getLastItem","CacheProto","$index","sort","a","b","argument","_isTop","Cache","instance","apply","setPrototypeOf","getOwnPropertyNames","methodName","generateElement","template","Node","ELEMENT_NODE","tagName","toLowerCase","table","find","Padding","useCache","cache","Viewport","viewportController","$rootScope","topPadding","bottomPadding","viewport","container","bufferPadding","getScope","createPaddingElements","applyContainerStyle","bottomDataPos","scrollHeight","topDataPos","bottomVisiblePos","topVisiblePos","e","sibling","insertElementAnimated","shouldLoadBottom","clipBottom","overage","emptySpaceHeight","floor","itemHeight","overageHeight","add","adjustPaddings","shouldLoadTop","clipTop","visibleItemsHeight","reduce","summ","topPaddingHeight","topCount","bottomPaddingHeight","bottomCount","totalHeight","averageItemHeight","adjustTopPadding","adjustBottomPadding","topPaddingHeightAdd","bottomPaddingHeightAdd","onAfterMinIndexSet","topPaddingHeightOld","diff","onAfterPrepend","updates","prepended","paddingHeight","resetTopPadding","clear","resetBottomPadding","removeCacheItem","removeItem","Adapter","$scope","$parse","$attr","doAdjust","reload","isLoading","disabled","viewportScope","startScope","$parent","publicContext","assignAdapter","adapter","generatePublicContext","adapterAttr","replace","adapterOnScope","assign","error","message","publicMethods","bind","publicProps","property","attr","defineProperty","set","publicPropsImmediate","newItems","arg3","applyUpdatesFunc","noAdjust","applyUpdatesIndex","cb","options","slice","applyUpdate","_index","isArray","immutableTop","position","some","newItem","rowTop","topHeight","topDone","bottomDone","itemTop","isEOF","module","constant","run","elt","jQuery","fn","jquery","registerFor","addCSSRules","directive","restrict","controller","child","console","$timeout","$interval","require","transclude","priority","terminal","link","controllers","linker","match","uiScroll","parseNumber","defaultValue","isFloat","isNaN","parseNumericAttr","BUFFER_MIN","BUFFER_DEFAULT","PADDING_MIN","PADDING_DEFAULT","START_INDEX_DEFAULT","MAX_VIEWPORT_DELAY","VIEWPORT_POLLING_INTERVAL","datasource","itemName","datasourceName","allowVisibilityWatch","ridActual","pending","scPreviousScrollTop","isDatasourceValid","toString","onRenderHandlers","onRenderHandlersRunner","handler","persistDatasourceIndex","propName","getter","id","defineDatasourceIndex","propUserName","descriptor","getOwnPropertyDescriptor","fetchNext","success","count","fetchPrevious","initialize","tryCount","timer","cancel","clone","$on","unbindEvents","unbind","wheelHandler","isInvalid","rid","$$destroyed","bindEvents","resizeAndScrollHandler","isPendingScroll","_resizeAndScrollHandler","isElementVisible","visibilityWatcher","unregisterVisibilityWatcher","insertWrapperContent","insertAfter","createElement","$watch","hideElement","promises","transform","tdInitializer","uiScrollTdInitializer","linking","onLink","updateDOM","toBePrepended","toBeRemoved","inserted","concat","removed","animated","updatePaddings","all","enqueueFetch","calculateAbsoluteScroll","loading","fetch","processUpdates","changes","$$phase","$digest","w","showElement","calculateProperties","doAdjustAfterFetch","shift","sc","scTimer","clearTimeout","setTimeout","newFirst","event","yMax","clientHeight","preventDefault"],"mappings":"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","file":"ui-scroll.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","/*!\n globals: angular, window\n List of used element methods available in JQuery but not in JQuery Lite\n element.before(elem)\n element.height()\n element.outerHeight(true)\n element.height(value) = only for Top/Bottom padding elements\n element.scrollTop()\n element.scrollTop(value)\n */\n\nexport default class JQLiteExtras {\n\n  registerFor(element) {\n    let convertToPx, css, getStyle, isWindow;\n    // angular implementation blows up if elem is the window\n    css = angular.element.prototype.css;\n\n    element.prototype.css = function (name, value) {\n      let self = this;\n      let elem = self[0];\n      if (!(!elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style)) {\n        return css.call(self, name, value);\n      }\n    };\n\n    // as defined in angularjs v1.0.5\n    isWindow = (obj) => obj && obj.document && obj.location && obj.alert && obj.setInterval;\n\n    function scrollTo(self, direction, value) {\n      let elem = self[0];\n      let [method, prop, preserve] = {\n        top: [\n          'scrollTop',\n          'pageYOffset',\n          'scrollLeft'\n        ],\n        left: [\n          'scrollLeft',\n          'pageXOffset',\n          'scrollTop'\n        ]\n      }[direction];\n\n      const isValueDefined = typeof value !== 'undefined';\n      if (isWindow(elem)) {\n        if (isValueDefined) {\n          return elem.scrollTo(self[preserve].call(self), value);\n        }\n        return (prop in elem) ? elem[prop] : elem.document.documentElement[method];\n      } else {\n        if (isValueDefined) {\n          elem[method] = value;\n        }\n        return elem[method];\n      }\n    }\n\n    if (window.getComputedStyle) {\n      getStyle = (elem) => window.getComputedStyle(elem, null);\n      convertToPx = (elem, value) => parseFloat(value);\n    } else {\n      getStyle = (elem) => elem.currentStyle;\n      convertToPx = (elem, value) => {\n        let left, result, rs, rsLeft, style;\n        let core_pnum = /[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source;\n        let rnumnonpx = new RegExp('^(' + core_pnum + ')(?!px)[a-z%]+$', 'i');\n\n        if (!rnumnonpx.test(value)) {\n          return parseFloat(value);\n        }\n\n        // ported from JQuery\n        style = elem.style;\n        left = style.left;\n        rs = elem.runtimeStyle;\n        rsLeft = rs && rs.left;\n        if (rs) {\n          rs.left = style.left;\n        }\n        // put in the new values to get a computed style out\n        style.left = value;\n        result = style.pixelLeft;\n        style.left = left;\n        if (rsLeft) {\n          rs.left = rsLeft;\n        }\n        return result;\n      };\n    }\n\n    function getMeasurements(elem, measure) {\n      let base, borderA, borderB, computedMarginA, computedMarginB, computedStyle, dirA, dirB, marginA, marginB, paddingA, paddingB;\n\n      if (isWindow(elem)) {\n        base = document.documentElement[{height: 'clientHeight', width: 'clientWidth'}[measure]];\n\n        return {\n          base: base,\n          padding: 0,\n          border: 0,\n          margin: 0\n        };\n      }\n\n      // Start with offset property\n      [\n        base,\n        dirA,\n        dirB\n      ] = {\n        width: [\n          elem.offsetWidth,\n          'Left',\n          'Right'\n        ],\n        height: [\n          elem.offsetHeight,\n          'Top',\n          'Bottom'\n        ]\n      }[measure];\n\n      computedStyle = getStyle(elem);\n      paddingA = convertToPx(elem, computedStyle['padding' + dirA]) || 0;\n      paddingB = convertToPx(elem, computedStyle['padding' + dirB]) || 0;\n      borderA = convertToPx(elem, computedStyle['border' + dirA + 'Width']) || 0;\n      borderB = convertToPx(elem, computedStyle['border' + dirB + 'Width']) || 0;\n      computedMarginA = computedStyle['margin' + dirA];\n      computedMarginB = computedStyle['margin' + dirB];\n\n      // I do not care for width for now, so this hack is irrelevant\n      // if ( !supportsPercentMargin )\n      // computedMarginA = hackPercentMargin( elem, computedStyle, computedMarginA )\n      // computedMarginB = hackPercentMargin( elem, computedStyle, computedMarginB )\n      marginA = convertToPx(elem, computedMarginA) || 0;\n      marginB = convertToPx(elem, computedMarginB) || 0;\n\n      return {\n        base: base,\n        padding: paddingA + paddingB,\n        border: borderA + borderB,\n        margin: marginA + marginB\n      };\n    }\n\n    function getWidthHeight(elem, direction, measure) {\n      let computedStyle, result;\n\n      let measurements = getMeasurements(elem, direction);\n\n      if (measurements.base > 0) {\n        return {\n          base: measurements.base - measurements.padding - measurements.border,\n          outer: measurements.base,\n          outerfull: measurements.base + measurements.margin\n        }[measure];\n      }\n\n      // Fall back to computed then uncomputed css if necessary\n      computedStyle = getStyle(elem);\n      result = computedStyle[direction];\n\n      if (result < 0 || result === null) {\n        result = elem.style[direction] || 0;\n      }\n\n      // Normalize \"\", auto, and prepare for extra\n      result = parseFloat(result) || 0;\n\n      return {\n        base: result - measurements.padding - measurements.border,\n        outer: result,\n        outerfull: result + measurements.padding + measurements.border + measurements.margin\n      }[measure];\n    }\n\n    // define missing methods\n    return angular.forEach({\n      before(newElem) {\n        var children, elem, i, j, parent, ref, self;\n        self = this;\n        elem = self[0];\n        parent = self.parent();\n        children = parent.contents();\n        if (children[0] === elem) {\n          return parent.prepend(newElem);\n        } else {\n          for (i = j = 1, ref = children.length - 1; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n            if (children[i] === elem) {\n              angular.element(children[i - 1]).after(newElem);\n              return;\n            }\n          }\n          throw new Error('invalid DOM structure ' + elem.outerHTML);\n        }\n      },\n      height (value){\n        var self;\n        self = this;\n        if (typeof value !== 'undefined') {\n          if (angular.isNumber(value)) {\n            value = value + 'px';\n          }\n          return css.call(self, 'height', value);\n        } else {\n          return getWidthHeight(this[0], 'height', 'base');\n        }\n      },\n      outerHeight(option) {\n        return getWidthHeight(this[0], 'height', option ? 'outerfull' : 'outer');\n      },\n      outerWidth(option) {\n        return getWidthHeight(this[0], 'width', option ? 'outerfull' : 'outer');\n      },\n\n      /*\n       The offset setter method is not implemented\n       */\n      offset(value) {\n        let docElem, win;\n        let self = this;\n        let box = {\n          top: 0,\n          left: 0\n        };\n        let elem = self[0];\n        let doc = elem && elem.ownerDocument;\n\n        if (arguments.length) {\n          if (value === undefined) {\n            return self;\n          }\n          // TODO: implement setter\n          throw new Error('offset setter method is not implemented');\n        }\n\n        if (!doc) {\n          return;\n        }\n\n        docElem = doc.documentElement;\n\n        // TODO: Make sure it's not a disconnected DOM node\n\n        if (elem.getBoundingClientRect != null) {\n          box = elem.getBoundingClientRect();\n        }\n\n        win = doc.defaultView || doc.parentWindow;\n\n        return {\n          top: box.top + (win.pageYOffset || docElem.scrollTop) - (docElem.clientTop || 0),\n          left: box.left + (win.pageXOffset || docElem.scrollLeft) - (docElem.clientLeft || 0)\n        };\n      },\n      scrollTop(value) {\n        return scrollTo(this, 'top', value);\n      },\n      scrollLeft(value) {\n        return scrollTo(this, 'left', value);\n      }\n    }, (value, key) => {\n      if (!element.prototype[key]) {\n        return element.prototype[key] = value;\n      }\n    });\n  }\n\n}\n","const hideClassToken = 'ng-ui-scroll-hide';\n\nexport default class ElementRoutines {\n\n  static addCSSRules() {\n    const selector = '.' + hideClassToken;\n    const rules = 'display: none';\n    const sheet = document.styleSheets[0];\n    let index;\n    try {\n      index = sheet.cssRules.length;\n    } catch (err) {\n      index = 0;\n    }\n    if('insertRule' in sheet) {\n      sheet.insertRule(selector + '{' + rules + '}', index);\n    }\n    else if('addRule' in sheet) {\n      sheet.addRule(selector, rules, index);\n    }\n  }\n\n  constructor($injector, $q) {\n    this.$animate = ($injector.has && $injector.has('$animate')) ? $injector.get('$animate') : null;\n    this.isAngularVersionLessThen1_3 = angular.version.major === 1 && angular.version.minor < 3;\n    this.$q = $q;\n  }\n\n  hideElement(wrapper) {\n    wrapper.element.addClass(hideClassToken);\n  }\n\n  showElement(wrapper) {\n    wrapper.element.removeClass(hideClassToken);\n  }\n\n  insertElement(newElement, previousElement) {\n    previousElement.after(newElement);\n    return [];\n  }\n\n  removeElement(wrapper) {\n    wrapper.element.remove();\n    wrapper.scope.$destroy();\n    return [];\n  }\n\n  insertElementAnimated(newElement, previousElement) {\n    if (!this.$animate) {\n      return this.insertElement(newElement, previousElement);\n    }\n\n    if (this.isAngularVersionLessThen1_3) {\n      const deferred = this.$q.defer();\n      // no need for parent - previous element is never null\n      this.$animate.enter(newElement, null, previousElement, () => deferred.resolve());\n\n      return [deferred.promise];\n    }\n\n    // no need for parent - previous element is never null\n    return [this.$animate.enter(newElement, null, previousElement)];\n  }\n\n  removeElementAnimated(wrapper) {\n    if (!this.$animate) {\n      return this.removeElement(wrapper);\n    }\n\n    if (this.isAngularVersionLessThen1_3) {\n      const deferred = this.$q.defer();\n      this.$animate.leave(wrapper.element, () => {\n        wrapper.scope.$destroy();\n        return deferred.resolve();\n      });\n\n      return [deferred.promise];\n    }\n\n    return [(this.$animate.leave(wrapper.element)).then(() => wrapper.scope.$destroy())];\n  }\n}","export default function ScrollBuffer(elementRoutines, bufferSize, startIndex, rowHeight) {\n  const buffer = Object.create(Array.prototype);\n\n  angular.extend(buffer, {\n    size: bufferSize,\n\n    reset(startIndex) {\n      buffer.remove(0, buffer.length);\n      buffer.eof = false;\n      buffer.bof = false;\n      buffer.first = startIndex;\n      buffer.next = startIndex;\n      buffer.minIndex = startIndex; // Calculated when data is effectively accessed\n      buffer.maxIndex = startIndex;\n      buffer.minIndexUser = null; // as set by the user (datasource)\n      buffer.maxIndexUser = null;\n    },\n    \n    // PHIL: set the new index to be displayed without resettng the sroll and the calculated min/max\n    // Note that this actually make sense with a fixed rowHeight when the scroll value can be calculated\n    // for a # of rows\n    resetStartIndex: function resetStartIndex(startIndex) {\n      buffer.remove(0, buffer.length);\n      buffer.eof = buffer.eof && startIndex==buffer.maxIndex;\n      buffer.bof = buffer.bof && startIndex==buffer.minIndex;\n      buffer.first = startIndex;\n      buffer.next = startIndex;\n    },\n\n    append(items) {\n      items.forEach((item) => {\n        ++buffer.next;\n        buffer.insert('append', item);\n      });\n      buffer.maxIndex = buffer.eof ? buffer.next - 1 : Math.max(buffer.next - 1, buffer.maxIndex);\n    },\n\n    prepend(items) {\n      items.reverse().forEach((item) => {\n        --buffer.first;\n        buffer.insert('prepend', item);\n      });\n      buffer.minIndex = buffer.bof ? buffer.minIndex = buffer.first : Math.min(buffer.first, buffer.minIndex);\n    },\n\n    /**\n     * inserts wrapped element in the buffer\n     * the first argument is either operation keyword (see below) or a number for operation 'insert'\n     * for insert the number is the index for the buffer element the new one have to be inserted after\n     * operations: 'append', 'prepend', 'insert', 'remove', 'update', 'none'\n     */\n    insert(operation, item, isTop) {\n      const wrapper = {\n        item: item\n      };\n\n      if (operation % 1 === 0) {// it is an insert\n        wrapper.op = 'insert';\n        buffer.splice(operation, 0, wrapper);\n        if(isTop) {\n          buffer.first--;\n        }\n        else {\n          buffer.next++;\n        }\n      } else {\n        wrapper.op = operation;\n        switch (operation) {\n          case 'append':\n            buffer.push(wrapper);\n            break;\n          case 'prepend':\n            buffer.unshift(wrapper);\n            break;\n        }\n      }\n    },\n\n    // removes elements from buffer\n    remove(arg1, arg2) {\n      if (angular.isNumber(arg1)) {\n        // removes items from arg1 (including) through arg2 (excluding)\n        for (let i = arg1; i < arg2; i++) {\n          elementRoutines.removeElement(buffer[i]);\n        }\n        return buffer.splice(arg1, arg2 - arg1);\n      }\n      // removes single item(wrapper) from the buffer\n      buffer.splice(buffer.indexOf(arg1), 1);\n      if(arg1._op === 'isTop' && buffer.first === this.getAbsMinIndex()) {\n        this.incrementMinIndex();\n      }\n      else {\n        this.decrementMaxIndex();\n      }\n      if(arg1._op === 'isTop') {\n        buffer.first++;\n      }\n      else {\n        buffer.next--;\n      }\n      if(!buffer.length) {\n        buffer.first = buffer.minIndex%1 ? buffer.minIndex : startIndex;\n        buffer.next = buffer.first;\n        buffer.eof = buffer.eof && buffer.first==buffer.maxIndex;\n      }\n\n      return elementRoutines.removeElementAnimated(arg1);\n    },\n\n    incrementMinIndex() {\n      if(buffer.minIndexUser !== null) {\n        if(buffer.minIndex > buffer.minIndexUser) {\n          buffer.minIndexUser++;\n          return;\n        }\n        if(buffer.minIndex === buffer.minIndexUser) {\n          buffer.minIndexUser++;\n        }\n      }\n      buffer.minIndex++;\n    },\n\n    decrementMaxIndex() {\n      if(buffer.maxIndexUser !== null && buffer.maxIndex <= buffer.maxIndexUser) {\n        buffer.maxIndexUser--;\n      }\n      buffer.maxIndex--;\n    },\n\n    getAbsMinIndex() {\n      if(buffer.minIndexUser !== null) {\n        return Math.min(buffer.minIndexUser, buffer.minIndex);\n      }\n      return buffer.minIndex;\n    },\n\n    getAbsMaxIndex() {\n      if(buffer.maxIndexUser !== null) {\n        return Math.max(buffer.maxIndexUser, buffer.maxIndex);\n      }\n      return buffer.maxIndex;\n    },\n\n    effectiveHeight(elements) {\n      if (!elements.length) {\n        return 0;\n      }\n      let top = Number.MAX_VALUE;\n      let bottom = Number.NEGATIVE_INFINITY;\n      elements.forEach((wrapper) => {\n        if (wrapper.element[0].offsetParent) {\n          // element style is not display:none\n          top = Math.min(top, wrapper.element.offset().top);\n          bottom = Math.max(bottom, wrapper.element.offset().top + (rowHeight || wrapper.element.outerHeight(true)));\n        }\n      });\n      return Math.max(0, bottom - top);\n    },\n\n    getItems() {\n      return buffer.filter(item => item.op === 'none');\n    },\n\n    getFirstItem() {\n      const list = buffer.getItems();\n      if (!list.length) {\n        return null;\n      }\n      return list[0].item;\n    },\n\n    getLastItem() {\n      const list = buffer.getItems();\n      if (!list.length) {\n        return null;\n      }\n      return list[list.length - 1].item;\n    }\n\n  });\n\n  buffer.reset(startIndex);\n\n  return buffer;\n}\n","// Can't just extend the Array, due to Babel does not support built-in classes extending\n// This solution was taken from https://stackoverflow.com/questions/46897414/es6-class-extends-array-workaround-for-es5-babel-transpile\nclass CacheProto {\n  add(item) {\n    for (let i = this.length - 1; i >= 0; i--) {\n      if (this[i].index === item.scope.$index) {\n        this[i].height = item.element.outerHeight();\n        return;\n      }\n    }\n    this.push({\n      index: item.scope.$index,\n      height: item.element.outerHeight()\n    });\n    this.sort((a, b) => ((a.index < b.index) ? -1 : ((a.index > b.index) ? 1 : 0)));\n  }\n\n  remove(argument, _isTop) {\n    const index = argument % 1 === 0 ? argument : argument.scope.$index;\n    const isTop = argument % 1 === 0 ? _isTop : argument._op === 'isTop';\n    for (let i = this.length - 1; i >= 0; i--) {\n      if (this[i].index === index) {\n        this.splice(i, 1);\n        break;\n      }\n    }\n    if(!isTop) {\n      for (let i = this.length - 1; i >= 0; i--) {\n        if (this[i].index > index) {\n          this[i].index--;\n        }\n      }\n    }\n  }\n\n  clear() {\n    this.length = 0;\n  }\n}\n\nfunction Cache() {\n  const instance = [];\n  instance.push.apply(instance, arguments);\n  Object.setPrototypeOf(instance, Cache.prototype);\n  return instance;\n}\nCache.prototype = Object.create(Array.prototype);\nObject.getOwnPropertyNames(CacheProto.prototype).forEach(methodName =>\n  Cache.prototype[methodName] = CacheProto.prototype[methodName]\n);\n\nfunction generateElement(template) {\n  if(template.nodeType !== Node.ELEMENT_NODE) {\n    throw new Error('ui-scroll directive requires an Element node for templating the view');\n  }\n  let element;\n  switch (template.tagName.toLowerCase()) {\n    case 'dl':\n      throw new Error(`ui-scroll directive does not support <${template.tagName}> as a repeating tag: ${template.outerHTML}`);\n    case 'tr':\n      let table = angular.element('<table><tr><td><div></div></td></tr></table>');\n      element = table.find('tr');\n      break;\n    case 'li':\n      element = angular.element('<li></li>');\n      break;\n    default:\n      element = angular.element('<div></div>');\n  }\n  return element;\n}\n\n//\n// Padding represents the dummy element added to both the top and the bottom of the scrolling container\n// It holds the element, as well as a cache for the items (rows) height. In case of a fixed rowHeight, the \n// cache is not used and thus is not created.\n//\nclass Padding {\n  constructor(template,useCache) {\n    this.element = generateElement(template);\n    if(useCache) {\n      this.cache = new Cache();\n    }\n  }\n\n  height() {\n    // When called with a parameter, this sets the height of the padding\n    return this.element.height.apply(this.element, arguments);\n  }\n}\n\nexport default Padding;","import Padding from './padding';\n\nexport default function Viewport(elementRoutines, buffer, element, viewportController, $rootScope, padding, rowHeight) {\n  let topPadding = null;\n  let bottomPadding = null;\n  const viewport = viewportController && viewportController.viewport ? viewportController.viewport : angular.element(window);\n  const container = viewportController && viewportController.container ? viewportController.container : undefined;\n  const scope = viewportController && viewportController.scope ? viewportController.scope : $rootScope;\n\n  viewport.css({\n    'overflow-anchor': 'none',\n    'overflow-y': 'auto',\n    'display': 'block'\n  });\n\n  function bufferPadding() {\n    return viewport.outerHeight() * padding; // some extra space to initiate preload\n  }\n\n  // \n  //   Viewport measurements\n  //\n  //     +----------------+  0\n  //     |      top       |\n  //     |    padding     |\n  //     +----------------+  topDataPos() [=topPadding.height]\n  //     |   not visible  |\n  //     |      items     |\n  //     +----------------+  topVisiblePos() [=viewport.scrollTop]\n  //     |                |\n  //     |     visible    |\n  //     |      items     |\n  //     |                |\n  //     +----------------+  bottomVisiblePos() [=viewport.scrollTop+viewport.height]\n  //     |   not visible  |\n  //     |      items     |\n  //     +----------------+  bottomDataPos() [=scrollHeight-bottomPadding.height]\n  //     |    bottom      |\n  //     |    padding     |\n  //     +----------------+  scrollHeight \n  //\n  // bufferPadding is some extra space we have top & bottom to allow infinite scrolling\n  //          bufferPadding = viewport.outerHeight() * padding\n  //\n  //  bottomVisiblePos() - topVisiblePos() == viewport.outerHeight()\n  \n\n  angular.extend(viewport, {\n    getScope() {\n      return scope;\n    },\n\n    createPaddingElements(template) {\n      topPadding = new Padding(template,!rowHeight);\n      bottomPadding = new Padding(template,!rowHeight);\n      element.before(topPadding.element);\n      element.after(bottomPadding.element);\n      topPadding.height(0);\n      bottomPadding.height(0);\n    },\n\n    applyContainerStyle() {\n      if (!container) {\n        return true;\n      }\n      if(container !== viewport) {\n        viewport.css('height', window.getComputedStyle(container[0]).height);\n      }\n      return viewport.height() > 0;\n    },\n\n    bottomDataPos() {\n      let scrollHeight = viewport[0].scrollHeight;\n      scrollHeight = scrollHeight != null ? scrollHeight : viewport[0].document.documentElement.scrollHeight;\n      return scrollHeight - bottomPadding.height();\n    },\n\n    topDataPos() {\n      return topPadding.height();\n    },\n\n    bottomVisiblePos() {\n      return viewport.scrollTop() + viewport.outerHeight();\n    },\n\n    topVisiblePos() {\n      return viewport.scrollTop();\n    },\n\n    insertElement(e, sibling) {\n      return elementRoutines.insertElement(e, sibling || topPadding.element);\n    },\n\n    insertElementAnimated(e, sibling) {\n      return elementRoutines.insertElementAnimated(e, sibling || topPadding.element);\n    },\n\n    shouldLoadBottom() {\n      return !buffer.eof && viewport.bottomDataPos() < viewport.bottomVisiblePos() + bufferPadding();\n    },\n\n    clipBottom() {\n      // clip the invisible items off the bottom\n      let overage = 0;\n      let emptySpaceHeight = viewport.bottomDataPos() - viewport.bottomVisiblePos() - bufferPadding();\n      if(rowHeight) {\n        overage = Math.min(buffer.length,Math.floor(emptySpaceHeight/rowHeight));\n      } else {\n        let itemHeight = 0;\n        let overageHeight = 0;\n\n        for (let i = buffer.length - 1; i >= 0; i--) {\n          itemHeight = buffer[i].element.outerHeight(true);\n          if (overageHeight + itemHeight > emptySpaceHeight) {\n            break;\n          }\n          bottomPadding.cache.add(buffer[i]);\n          overageHeight += itemHeight;\n          overage++;\n        }\n      }\n\n      if (overage > 0) {\n        buffer.eof = false;\n        buffer.remove(buffer.length - overage, buffer.length);\n        buffer.next -= overage;\n        viewport.adjustPaddings();\n      }\n    },\n\n    shouldLoadTop() {\n      return !buffer.bof && (viewport.topDataPos() > viewport.topVisiblePos() - bufferPadding());\n    },\n\n    clipTop() {\n      // clip the invisible items off the top\n      let overage = 0;\n      let overageHeight = 0;\n      let emptySpaceHeight = viewport.topVisiblePos() - viewport.topDataPos() - bufferPadding();\n      if(rowHeight) {\n        overage = Math.min(buffer.length,Math.floor(emptySpaceHeight/rowHeight));\n        overageHeight = overage * rowHeight;\n      } else {\n        let itemHeight = 0;\n\n        for (let i = 0; i < buffer.length; i++) {\n          itemHeight = buffer[i].element.outerHeight(true);\n          if (overageHeight + itemHeight > emptySpaceHeight) {\n            break;\n          }\n          topPadding.cache.add(buffer[i]);\n          overageHeight += itemHeight;\n          overage++;\n        }\n      }\n\n      if (overage > 0) {\n        // we need to adjust top padding element before items are removed from top\n        // to avoid strange behaviour of scroll bar during remove top items when we are at the very bottom\n        topPadding.height(topPadding.height() + overageHeight);\n        buffer.bof = false;\n        buffer.remove(0, overage);\n        buffer.first += overage;\n      }\n    },\n\n    // PHIL: remove all the entries in the buffer without changing the scrollbar, nor the scroll position\n    // and update the padding accordingly\n    // It is designed to work with non fixed rowHeight, although it will need more tests in this area...\n    scrollTo(first) {\n      if(rowHeight) {\n        const min = buffer.getAbsMinIndex(); \n        const max = buffer.getAbsMaxIndex();\n        first = Math.min(Math.max(first, min),max);\n        // Adjust the paddings before removing the elements to avoid touching the scroll top position\n        topPadding.height((first-min)*rowHeight);\n        bottomPadding.height(((max+1)-first)*rowHeight);\n        buffer.resetStartIndex(first);\n      } else {\n        buffer.resetStartIndex(first);\n        viewport.adjustPaddings();\n      } \n    },\n   \n    adjustPaddings() {\n      if(rowHeight) {\n        const min = buffer.getAbsMinIndex(); \n        const max = buffer.getAbsMaxIndex();\n        topPadding.height((buffer.first-min)*rowHeight);\n        // PHIL: next points to the next possible item, while max is the index of the last one.\n        // In order to make them compatible, we should add one to max\n        // Also, it looks like buffer is not changing maxIndex when an element is inserted/appended\n        // Not sure if this can have a consequence or not....\n        bottomPadding.height(((max+1)-buffer.next)*rowHeight);\n        return;\n      }\n\n      if (!buffer.length) {\n        return;\n      }\n\n      // precise heights calculation based on items that are in buffer or that were in buffer once\n      const visibleItemsHeight = buffer.reduce((summ, item) => summ + item.element.outerHeight(true), 0);\n      let topPaddingHeight = 0, topCount = 0;\n      topPadding.cache.forEach(item => {\n        if(item.index < buffer.first) {\n          topPaddingHeight += item.height;\n          topCount++;\n        }\n      });\n \n      let bottomPaddingHeight = 0, bottomCount = 0;\n      bottomPadding.cache.forEach(item => {\n        if(item.index >= buffer.next) {\n          bottomPaddingHeight += item.height;\n          bottomCount++;\n        }\n      });\n \n      const totalHeight = visibleItemsHeight + topPaddingHeight + bottomPaddingHeight;\n      const averageItemHeight = totalHeight / (topCount + bottomCount + buffer.length);   \n\n      // average heights calculation, items that have never been reached\n      let adjustTopPadding = buffer.minIndexUser !== null && buffer.minIndex > buffer.minIndexUser;\n      let adjustBottomPadding = buffer.maxIndexUser !== null && buffer.maxIndex < buffer.maxIndexUser;\n      let topPaddingHeightAdd = adjustTopPadding ? (buffer.minIndex - buffer.minIndexUser) * averageItemHeight : 0;\n      let bottomPaddingHeightAdd = adjustBottomPadding ? (buffer.maxIndexUser - buffer.maxIndex) * averageItemHeight : 0;\n\n      // paddings combine adjustment\n      topPadding.height(topPaddingHeight + topPaddingHeightAdd);\n      bottomPadding.height(bottomPaddingHeight + bottomPaddingHeightAdd);\n    },\n\n    onAfterMinIndexSet(topPaddingHeightOld) {\n      // additional scrollTop adjustment in case of datasource.minIndex external set\n      if (buffer.minIndexUser !== null && buffer.minIndex > buffer.minIndexUser) {\n        let diff = topPadding.height() - topPaddingHeightOld;\n        viewport.scrollTop(viewport.scrollTop() + diff);\n        while((diff -= viewport.scrollTop()) > 0) {\n          bottomPadding.height(bottomPadding.height() + diff);\n          viewport.scrollTop(viewport.scrollTop() + diff);\n        }\n      }\n    },\n\n    onAfterPrepend(updates) {\n      if (!updates.prepended.length)\n        return;\n      const height = buffer.effectiveHeight(updates.prepended);\n      const paddingHeight = topPadding.height() - height;\n      if (paddingHeight >= 0) {\n        topPadding.height(paddingHeight);\n      }\n      else {\n        topPadding.height(0);\n        viewport.scrollTop(viewport.scrollTop() - paddingHeight);\n      }\n    },\n\n    resetTopPadding() {\n      topPadding.height(0);\n      if(topPadding.cache) {\n        topPadding.cache.clear();\n      }\n    },\n\n    resetBottomPadding() {\n      bottomPadding.height(0);\n      if(bottomPadding.cache) {\n        bottomPadding.cache.clear();\n      }\n    },\n\n    removeCacheItem(item, isTop) {\n      if(topPadding.cache) {\n        topPadding.cache.remove(item, isTop);\n      }\n      if(bottomPadding.cache) {\n        bottomPadding.cache.remove(item, isTop);\n      }\n    },\n\n    removeItem(item) {\n      this.removeCacheItem(item);\n      return buffer.remove(item);\n    }\n  });\n\n  return viewport;\n}\n","class Adapter {\n\n  constructor($scope, $parse, $attr, viewport, buffer, doAdjust, reload) {\n    this.$parse = $parse;\n    this.$attr = $attr;\n    this.viewport = viewport;\n    this.buffer = buffer;\n\n    this.doAdjust = doAdjust;\n    this.reload = reload;\n\n    this.isLoading = false;\n    this.disabled = false;\n\n    const viewportScope = viewport.getScope();\n    this.startScope = viewportScope.$parent ? viewportScope : $scope;\n\n    this.publicContext = {};\n    this.assignAdapter($attr.adapter);\n    this.generatePublicContext();\n  }\n\n  assignAdapter(adapterAttr) {\n    if (!adapterAttr || !(adapterAttr = adapterAttr.replace(/^\\s+|\\s+$/gm, ''))) {\n      return;\n    }\n    let adapterOnScope;\n\n    try {\n      this.$parse(adapterAttr).assign(this.startScope, {});\n      adapterOnScope = this.$parse(adapterAttr)(this.startScope);\n    }\n    catch (error) {\n      error.message = `Angular ui-scroll Adapter assignment exception.\\n` +\n        `Can't parse \"${adapterAttr}\" expression.\\n` +\n        error.message;\n      throw error;\n    }\n\n    angular.extend(adapterOnScope, this.publicContext);\n    this.publicContext = adapterOnScope;\n  }\n\n  generatePublicContext() {\n    // these methods will be accessible out of ui-scroll via user defined adapter\n    const publicMethods = ['reload', 'applyUpdates', 'append', 'prepend', 'isBOF', 'isEOF', 'isEmpty'];\n    for (let i = publicMethods.length - 1; i >= 0; i--) {\n      this.publicContext[publicMethods[i]] = this[publicMethods[i]].bind(this);\n    }\n\n    // these read-only props will be accessible out of ui-scroll via user defined adapter\n    const publicProps = ['isLoading', 'topVisible', 'topVisibleElement', 'topVisibleScope', 'bottomVisible', 'bottomVisibleElement', 'bottomVisibleScope'];\n    for (let i = publicProps.length - 1; i >= 0; i--) {\n      let property, attr = this.$attr[publicProps[i]];\n      Object.defineProperty(this, publicProps[i], {\n        get: () => property,\n        set: (value) => {\n          property = value;\n          this.publicContext[publicProps[i]] = value;\n          if (attr) {\n            this.$parse(attr).assign(this.startScope, value);\n          }\n        }\n      });\n    }\n\n    // read-only immediately calculated public properties\n    const publicPropsImmediate = ['bufferFirst', 'bufferLast', 'bufferLength'];\n    for (let i = publicPropsImmediate.length - 1; i >= 0; i--) {\n      Object.defineProperty(this.publicContext, publicPropsImmediate[i], {\n        get: () => this[publicPropsImmediate[i]]\n      });\n    }\n\n    // non-read-only public property\n    Object.defineProperty(this.publicContext, 'disabled', {\n      get: () => this.disabled,\n      set: (value) => (!(this.disabled = value)) ? this.doAdjust() : null\n    });\n  }\n\n  loading(value) {\n    this.isLoading = value;\n  }\n\n  isBOF() {\n    return this.buffer.bof;\n  }\n\n  isEOF() {\n    return this.buffer.eof;\n  }\n\n  isEmpty() {\n    return !this.buffer.length;\n  }\n\n  get bufferLength() {\n    return this.buffer.getItems().length;\n  }\n\n  get bufferFirst() {\n    return this.buffer.getFirstItem();\n  }\n\n  get bufferLast() {\n    return this.buffer.getLastItem();\n  }\n\n  append(newItems) {\n    this.buffer.append(newItems);\n    this.doAdjust();\n    this.viewport.clipTop();\n    this.viewport.clipBottom();\n  }\n\n  prepend(newItems) {\n    this.buffer.prepend(newItems);\n    this.doAdjust();\n    this.viewport.clipTop();\n    this.viewport.clipBottom();\n  }\n\n  applyUpdates(arg1, arg2, arg3) {\n    if (typeof arg1 === 'function') {\n      this.applyUpdatesFunc(arg1, arg2);\n      if(arg2 && arg2.noAdjust) return;\n    } else {\n      this.applyUpdatesIndex(arg1, arg2, arg3);\n      if(arg3 && arg3.noAdjust) return;\n    }\n    this.doAdjust();\n  }\n\n  applyUpdatesFunc(cb, options) {\n    this.buffer.slice(0).forEach((wrapper) => {\n      // we need to do it on the buffer clone, because buffer content\n      // may change as we iterate through\n      this.applyUpdate(wrapper, cb(wrapper.item, wrapper.scope, wrapper.element), options);\n    });\n  }\n\n  applyUpdatesIndex(index, newItems, options = {}) {\n    if (index % 1 !== 0) {\n      throw new Error('applyUpdates - ' + index + ' is not a valid index (should be an integer)');\n    }\n    const _index = index - this.buffer.first;\n\n    // apply updates only within buffer\n    if (_index >= 0 && _index < this.buffer.length) {\n      this.applyUpdate(this.buffer[_index], newItems, options);\n    }\n    // out-of-buffer case: deletion may affect Paddings\n    else if(index >= this.buffer.getAbsMinIndex() && index <= this.buffer.getAbsMaxIndex()) {\n      if(angular.isArray(newItems) && !newItems.length) {\n        this.viewport.removeCacheItem(index, !options.immutableTop && index === this.buffer.minIndex);\n        if (!options.immutableTop && index === this.buffer.getAbsMinIndex()) {\n          this.buffer.incrementMinIndex();\n        }\n        else {\n          this.buffer.decrementMaxIndex();\n        }\n      }\n    }\n  }\n\n  applyUpdate(wrapper, newItems, options = {}) {\n    if (!angular.isArray(newItems)) {\n      return;\n    }\n    let position = this.buffer.indexOf(wrapper);\n    if (!newItems.reverse().some(newItem => newItem === wrapper.item)) {\n      wrapper.op = 'remove';\n      if (!options.immutableTop && position === 0 && !newItems.length) {\n        wrapper._op = 'isTop'; // to catch \"first\" edge case on remove\n      }\n    }\n    newItems.forEach((newItem) => {\n      if (newItem === wrapper.item) {\n        position--;\n      } else {\n        // 3 parameter (isTop) is to catch \"first\" edge case on insert\n        this.buffer.insert(position + 1, newItem, !options.immutableTop && position === -1);\n      }\n    });\n  }\n\n  calculateProperties() {\n    let rowTop = null, topHeight = 0;\n    let topDone = false, bottomDone = false;\n    const length = this.buffer.length;\n\n    for (let i = 0; i < length; i++) {\n      const item = this.buffer[i];\n      const itemTop = item.element.offset().top;\n\n      if (rowTop !== itemTop) { // a new row condition\n        const itemHeight = item.element.outerHeight(true);\n        const top = this.viewport.topDataPos() + topHeight + itemHeight;\n\n        if (!topDone && top > this.viewport.topVisiblePos()) {\n          topDone = true;\n          this['topVisible'] = item.item;\n          this['topVisibleElement'] = item.element;\n          this['topVisibleScope'] = item.scope;\n        }\n        if (!bottomDone && (top >= this.viewport.bottomVisiblePos() || (i === length - 1 && this.isEOF()))) {\n          bottomDone = true;\n          this['bottomVisible'] = item.item;\n          this['bottomVisibleElement'] = item.element;\n          this['bottomVisibleScope'] = item.scope;\n        }\n        topHeight += itemHeight;\n      }\n      rowTop = itemTop;\n\n      if (topDone && bottomDone) {\n        break;\n      }\n    }\n  }\n\n}\n\nexport default Adapter;\n","import JQLiteExtras from './modules/jqLiteExtras';\nimport ElementRoutines from './modules/elementRoutines.js';\nimport ScrollBuffer from './modules/buffer.js';\nimport Viewport from './modules/viewport.js';\nimport Adapter from './modules/adapter.js';\n\nangular.module('ui.scroll', [])\n\n  .constant('JQLiteExtras', JQLiteExtras)\n  .run(['JQLiteExtras', (JQLiteExtras) => {\n    const elt = angular.element;\n    !(window.jQuery && elt.fn && elt.fn.jquery) ? (new JQLiteExtras()).registerFor(elt) : null;\n    ElementRoutines.addCSSRules();\n  }])\n\n  .directive('uiScrollViewport', function () {\n    return {\n      restrict: 'A',\n      controller: [\n        '$scope',\n        '$element',\n        function (scope, element) {\n          this.container = element;\n          this.viewport = element;\n          this.scope = scope;\n\n          angular.forEach(element.children(), child => {\n            if (child.tagName.toLowerCase() === 'tbody') {\n              this.viewport = angular.element(child);\n            }\n          });\n\n          return this;\n        }\n      ]\n    };\n  })\n\n  .directive('uiScroll', [\n    '$log',\n    '$injector',\n    '$rootScope',\n    '$timeout',\n    '$interval',\n    '$q',\n    '$parse',\n    function (console, $injector, $rootScope, $timeout, $interval, $q, $parse) {\n\n      return {\n        require: ['?^uiScrollViewport'],\n        restrict: 'A',\n        transclude: 'element',\n        priority: 1000,\n        terminal: true,\n        link: link\n      };\n\n      function link($scope, element, $attr, controllers, linker) {\n        const match = $attr.uiScroll.match(/^\\s*(\\w+)\\s+in\\s+([(\\w|\\$)\\.]+)\\s*$/);\n        if (!match) {\n          throw new Error('Expected uiScroll in form of \\'_item_ in _datasource_\\' but got \\'' + $attr.uiScroll + '\\'');\n        }\n\n        function parseNumber(value, defaultValue, isFloat) {\n          if (!isFloat) {\n            value = value === null ? defaultValue : Math.floor(value);\n          }\n          return isNaN(value) ? defaultValue : value;\n        }\n\n        function parseNumericAttr(value, defaultValue, isFloat) {\n          const result = $parse(value)($scope);\n          return parseNumber(result, defaultValue, isFloat);\n        }\n\n        const BUFFER_MIN = 3; // Minimum size of the data source request\n        const BUFFER_DEFAULT = 10; // Default datasource request size\n        const PADDING_MIN = 0.3; // Mininum # of rows in the padding area\n        const PADDING_DEFAULT = 0.5; // Default # of rows in the padding area\n        const START_INDEX_DEFAULT = 1; // Default start index when requestng the first data block\n        const MAX_VIEWPORT_DELAY = 500; // Max time wait (ms) to get the viewport with an height>0\n        const VIEWPORT_POLLING_INTERVAL = 50; // Interval used to check the initial viewport height\n\n        let datasource = null;\n        const itemName = match[1]; // Name of the index variable to publish\n        const datasourceName = match[2]; // Name of the datasource to request the rows from\n        const viewportController = controllers[0]; // ViewportController, as specified in the require option (http://websystique.com/angularjs/angularjs-custom-directives-controllers-require-option-guide/)\n        const bufferSize = Math.max(BUFFER_MIN, parseNumericAttr($attr.bufferSize, BUFFER_DEFAULT)); \n        const padding = Math.max(PADDING_MIN, parseNumericAttr($attr.padding, PADDING_DEFAULT, true));\n        let startIndex = parseNumericAttr($attr.startIndex, START_INDEX_DEFAULT);\n\n        // PHIL: Provide a fixed row height\n        // \n        const rowHeight = parseNumericAttr($attr.rowHeight, null, false);\n\n        // PHIL: Read the visibility watch option, true by default\n        const allowVisibilityWatch = $attr.allowVisibilityWatch!=='false';\n\n        // Revision IDs\n        // \n        let ridActual = 0; // current data revision id\n        let pending = [];\n\n        const elementRoutines = new ElementRoutines($injector, $q);\n        const buffer = new ScrollBuffer(elementRoutines, bufferSize, startIndex, rowHeight);\n        const viewport = new Viewport(elementRoutines, buffer, element, viewportController, $rootScope, padding, rowHeight);\n        const adapter = new Adapter($scope, $parse, $attr, viewport, buffer, doAdjust, reload);\n\n        if (viewportController) {\n          viewportController.adapter = adapter;\n        }\n\n        // Currently, we only debounce the scroll events when a fixed rowHeight is provided\n        // as the unit tests will have to be adapted to support this feature\n        let scPreviousScrollTop=-1;\n\n        const isDatasourceValid = () =>\n          Object.prototype.toString.call(datasource) === '[object Object]' && typeof datasource.get === 'function';\n\n        datasource = $parse(datasourceName)($scope); // try to get datasource on scope\n        if (!isDatasourceValid()) {\n          datasource = $injector.get(datasourceName); // try to inject datasource as service\n          if (!isDatasourceValid()) {\n            throw new Error(datasourceName + ' is not a valid datasource');\n          }\n        }\n\n        let onRenderHandlers = [];\n        function onRenderHandlersRunner() {\n          onRenderHandlers.forEach(handler => handler.run());\n          onRenderHandlers = [];\n        }\n        function persistDatasourceIndex(datasource, propName) {\n          let getter;\n          // need to postpone min/maxIndexUser processing if the view is empty\n          if(angular.isNumber(datasource[propName])) {\n            getter = datasource[propName];\n            if(angular.isNumber(getter)) {\n              onRenderHandlers = onRenderHandlers.filter(handler => handler.id !== propName);\n              onRenderHandlers.push({\n                id: propName,\n                run: () => datasource[propName] = getter\n              });\n            }\n          }\n        }\n\n        function defineDatasourceIndex(datasource, propName, propUserName) {\n          const descriptor = Object.getOwnPropertyDescriptor(datasource, propName);\n          if (descriptor && (descriptor.set || descriptor.get)) {\n            return;\n          }\n          let getter;\n          persistDatasourceIndex(datasource, propName);\n          Object.defineProperty(datasource, propName, {\n            set: (value) => {\n              getter = value;\n              if(pending.length && !buffer.length) {\n                persistDatasourceIndex(datasource, propName);\n                return;\n              }\n              buffer[propUserName] = value;\n              const topPaddingHeightOld = viewport.topDataPos();\n              viewport.adjustPaddings();\n              if (propName === 'minIndex') {\n                viewport.onAfterMinIndexSet(topPaddingHeightOld);\n              }\n            },\n            get: () => getter\n          });\n        }\n\n        defineDatasourceIndex(datasource, 'minIndex', 'minIndexUser');\n        defineDatasourceIndex(datasource, 'maxIndex', 'maxIndexUser');\n\n        const fetchNext = (datasource.get.length !== 2) ?\n          (success) => datasource.get(buffer.next, bufferSize, success) :\n          (success) => {\n            datasource.get({\n              index: buffer.next,\n              append: buffer.length ? buffer[buffer.length - 1].item : void 0,\n              count: bufferSize\n            }, success);\n          };\n\n        const fetchPrevious = (datasource.get.length !== 2) ?\n          (success) => datasource.get(buffer.first - bufferSize, bufferSize, success) :\n          (success) => {\n            datasource.get({\n              index: buffer.first - bufferSize,\n              prepend: buffer.length ? buffer[0].item : void 0,\n              count: bufferSize\n            }, success);\n          };\n\n        const initialize = () => {\n          let tryCount = 0;\n          if(!viewport.applyContainerStyle()) {\n            const timer = $interval(() => {\n              tryCount++;\n              if(viewport.applyContainerStyle()) {\n                $interval.cancel(timer);\n                doAdjust();\n              }\n              if(tryCount * VIEWPORT_POLLING_INTERVAL >= MAX_VIEWPORT_DELAY) {\n                $interval.cancel(timer);\n                throw Error(`ui-scroll directive requires a viewport with non-zero height in ${MAX_VIEWPORT_DELAY}ms`);\n              }\n            }, VIEWPORT_POLLING_INTERVAL);\n          }\n          else {\n            doAdjust();\n          }\n        };\n\n        /**\n         * Build padding elements\n         *\n         * Calling linker is the only way I found to get access to the tag name of the template\n         * to prevent the directive scope from pollution a new scope is created and destroyed\n         * right after the builder creation is completed\n         */\n        linker((clone, scope) => {\n          viewport.createPaddingElements(clone[0]);\n          // we do not include the clone in the DOM. It means that the nested directives will not\n          // be able to reach the parent directives, but in this case it is intentional because we\n          // created the clone to access the template tag name\n          scope.$destroy();\n          clone.remove();\n        });\n\n        $scope.$on('$destroy', () => {\n          unbindEvents();\n          viewport.unbind('mousewheel', wheelHandler);\n        });\n\n        viewport.bind('mousewheel', wheelHandler);\n\n        initialize();\n\n        /* Private function definitions */\n\n        function isInvalid(rid) {\n          return (rid && rid !== ridActual) || $scope.$$destroyed;\n        }\n\n        function bindEvents() {\n          viewport.bind('resize', resizeAndScrollHandler);\n          viewport.bind('scroll', resizeAndScrollHandler);\n          // If a scroll event happened while the handler was not bounded, emit the scroll\n          if(isPendingScroll()) {\n            // Do it immediately\n            _resizeAndScrollHandler();\n          }\n        }\n\n        function unbindEvents() {\n          viewport.unbind('resize', resizeAndScrollHandler);\n          viewport.unbind('scroll', resizeAndScrollHandler);\n        }\n\n        function reload() {\n          unbindEvents();\n          viewport.resetTopPadding();\n          viewport.resetBottomPadding();\n          if (arguments.length) {\n            startIndex = parseNumber(arguments[0], START_INDEX_DEFAULT, false);\n          }\n          buffer.reset(startIndex);\n          scPreviousScrollTop = -1; // Avoid isScrollPending() to be true\n          persistDatasourceIndex(datasource, 'minIndex');\n          persistDatasourceIndex(datasource, 'maxIndex');\n          doAdjust();\n        }\n\n        function scrollTo(first) {\n          unbindEvents();\n          viewport.scrollTo(first);\n          doAdjust();\n        }\n\n        function isElementVisible(wrapper) {\n          return (rowHeight || wrapper.element.height()) && wrapper.element[0].offsetParent;\n        }\n\n        function visibilityWatcher(wrapper) {\n          if (isElementVisible(wrapper)) {\n            buffer.forEach((item) => {\n              if (typeof item.unregisterVisibilityWatcher === 'function') {\n                item.unregisterVisibilityWatcher();\n                delete item.unregisterVisibilityWatcher;\n              }\n            });\n            if (!pending.length) {\n              $timeout(() => doAdjust());\n            }\n          }\n        }\n\n        function insertWrapperContent(wrapper, insertAfter) {\n          createElement(wrapper, insertAfter, viewport.insertElement);\n          if (allowVisibilityWatch && !isElementVisible(wrapper)) {\n            wrapper.unregisterVisibilityWatcher = wrapper.scope.$watch(() => visibilityWatcher(wrapper));\n          }\n          if (allowVisibilityWatch) {\n            elementRoutines.hideElement(wrapper); // hide inserted elements before data binding\n          }\n        }\n\n        function createElement(wrapper, insertAfter, insertElement) {\n          let promises = null;\n          const sibling = (insertAfter > 0) ? buffer[insertAfter - 1].element : undefined;\n          linker((clone, scope) => {\n            promises = insertElement(clone, sibling);\n            wrapper.element = clone;\n            wrapper.scope = scope;\n            scope[itemName] = wrapper.item;\n          });\n          // ui-scroll-grid apply\n          if (adapter.transform) {\n            const tdInitializer = wrapper.scope.uiScrollTdInitializer;\n            if (tdInitializer && tdInitializer.linking) {\n              adapter.transform(wrapper.scope, wrapper.element);\n            } else {\n              wrapper.scope.uiScrollTdInitializer = {\n                onLink: () => adapter.transform(wrapper.scope, wrapper.element),\n                scope: wrapper.scope\n              };\n            }\n          }\n          return promises;\n        }\n\n        function updateDOM() {\n          let promises = [];\n          const toBePrepended = [];\n          const toBeRemoved = [];\n          const inserted = [];\n\n          buffer.forEach((wrapper, i) => {\n            switch (wrapper.op) {\n              case 'prepend':\n                toBePrepended.unshift(wrapper);\n                break;\n              case 'append':\n                insertWrapperContent(wrapper, i);\n                wrapper.op = 'none';\n                inserted.push(wrapper);\n                break;\n              case 'insert':\n                promises = promises.concat(createElement(wrapper, i, viewport.insertElementAnimated));\n                wrapper.op = 'none';\n                inserted.push(wrapper);\n                break;\n              case 'remove':\n                toBeRemoved.push(wrapper);\n            }\n          });\n\n          toBeRemoved.forEach((wrapper) => promises = promises.concat(viewport.removeItem(wrapper)));\n\n          if (toBePrepended.length)\n            toBePrepended.forEach((wrapper) => {\n              insertWrapperContent(wrapper);\n              wrapper.op = 'none';\n            });\n\n          buffer.forEach((item, i) => item.scope.$index = buffer.first + i);\n\n          return {\n            prepended: toBePrepended,\n            removed: toBeRemoved,\n            inserted: inserted,\n            animated: promises\n          };\n\n        }\n\n        // Adjust the viewport paddings\n        // \n        function updatePaddings(rid, updates) {\n          // schedule another doAdjust after animation completion\n          if (updates.animated.length) {\n            $q.all(updates.animated).then(() => {\n              viewport.adjustPaddings();\n              doAdjust(rid);\n            });\n          } else {\n            viewport.adjustPaddings();\n          }\n        }\n\n        function enqueueFetch(rid, updates) {\n          // If there is a scroll pending, we don't enqueue the fetch as the scroll might be an absolute scroll\n          // So we don't need to load top or bottom\n          // This happens when there is a scroll frenzi, and the $digest is slow enough, so it stacks the calls without\n          // giving a chance to the scroll event to be emitted and processed.\n          // We also do that if it leads to an absolute scroll\n          if(isPendingScroll() && calculateAbsoluteScroll()!==undefined) {\n            // Looks like the event is swallowed on some browsers (FF) on some scroll configuration\n            resizeAndScrollHandler();\n            return;\n          }\n\n          if (viewport.shouldLoadBottom()) {\n            if (!updates || buffer.effectiveHeight(updates.inserted) > 0) {\n              // this means that at least one item appended in the last batch has height > 0\n              if (pending.push(true) === 1) {\n                adapter.loading(true);\n                fetch(rid);\n              }\n            }\n          } else if (viewport.shouldLoadTop()) {\n            if ((!updates || buffer.effectiveHeight(updates.prepended) > 0) || pending[0]) {\n              // this means that at least one item appended in the last batch has height > 0\n              // pending[0] = true means that previous fetch was appending. We need to force at least one prepend\n              // BTW there will always be at least 1 element in the pending array because bottom is fetched first\n              if (pending.push(false) === 1) {\n                adapter.loading(true);\n                fetch(rid);\n              }\n            }\n          }\n        }\n\n        function processUpdates() {\n          const updates = updateDOM();\n\n          // We need the item bindings to be processed before we can do adjustments\n          // If there  are no changes and the row-height is static, then ignore it!\n          const changes = updates.animated.length+updates.inserted.length+updates.prepended.length+updates.removed.length;\n          if(changes || !rowHeight) {\n            !$scope.$$phase && !$rootScope.$$phase && $scope.$digest();\n          }\n\n          if (allowVisibilityWatch) {\n            updates.inserted.forEach(w => elementRoutines.showElement(w));\n            updates.prepended.forEach(w => elementRoutines.showElement(w));\n          }\n\n          return updates;\n        }\n\n        function doAdjust(rid) {\n          if (!rid) { // dismiss pending requests\n            pending = [];\n            rid = ++ridActual;\n          }\n\n          const updates = processUpdates();\n\n          if (isInvalid(rid)) {\n            return;\n          }\n\n          updatePaddings(rid, updates);\n          enqueueFetch(rid);\n\n          if (!pending.length) {\n            adapter.calculateProperties();\n          }\n        }\n\n        function doAdjustAfterFetch(rid) {\n          const updates = processUpdates();\n\n          viewport.onAfterPrepend(updates);\n\n          if (isInvalid(rid)) {\n            return;\n          }\n\n          updatePaddings(rid, updates);\n          onRenderHandlersRunner();\n          enqueueFetch(rid, updates);\n          pending.shift();\n\n          if (pending.length)\n            fetch(rid);\n          else {\n            adapter.loading(false);\n            bindEvents();\n            adapter.calculateProperties();\n          }\n        }\n\n        function fetch(rid) {\n          if (pending[0]) {// scrolling down\n            if (buffer.length && !viewport.shouldLoadBottom()) {\n              doAdjustAfterFetch(rid);\n            } else {\n              fetchNext((result) => {\n                if (isInvalid(rid)) {\n                  return;\n                }\n\n                if (result.length < bufferSize) {\n                  buffer.eof = true;\n                }\n\n                if (result.length > 0) {\n                  viewport.clipTop();\n                  buffer.append(result);\n                }\n\n                doAdjustAfterFetch(rid);\n              });\n            }\n          } else {  // scrolling up\n            if (buffer.length && !viewport.shouldLoadTop()) {\n              doAdjustAfterFetch(rid);\n            } else {\n              fetchPrevious((result) => {\n                if (isInvalid(rid)) {\n                  return;\n                }\n\n                if (result.length < bufferSize) {\n                  buffer.bof = true;\n                  // log 'bof is reached'\n                }\n\n                if (result.length > 0) {\n                  if (buffer.length) {\n                    viewport.clipBottom();\n                  }\n                  buffer.prepend(result);\n                }\n\n                doAdjustAfterFetch(rid);\n              });\n            }\n          }\n        }\n\n        function isPendingScroll() {\n          if(rowHeight) {\n            // Maybe the scroll changed but the event has *not* yet being dispatched\n            // because of the $digest running and taking to long\n            var sc = viewport.scrollTop();\n            if(sc!=scPreviousScrollTop && scPreviousScrollTop>=0) {\n              return true;\n            }\n          }\n          return false;\n        }\n\n        // Deboucing the scroll events avois intermediate $digest when scrolling fast\n        let scTimer;\n        function resizeAndScrollHandler() {\n          if (rowHeight) {\n            if (scTimer) clearTimeout(scTimer);\n            scTimer = setTimeout(_resizeAndScrollHandler, 50);\n          } else {\n            _resizeAndScrollHandler();\n          }\n        }\n\n        function _resizeAndScrollHandler() {\n          if (!$rootScope.$$phase && !adapter.isLoading && !adapter.disabled) {\n            // Absolute positioning currently only works when a fixed rowHeight is provided\n            // We might isolate the averegaRowHeight calculation in the viewport to provide an estimate\n            // and provide a reasonable behavior with variable height as well\n            if(rowHeight) {\n              const newFirst = calculateAbsoluteScroll();\n              if(newFirst!==undefined) {\n                scrollTo(newFirst);\n                return;\n              }\n            }\n\n            enqueueFetch(ridActual);\n\n            if (pending.length) {\n              unbindEvents();\n            } else {\n              adapter.calculateProperties();\n              if(!rowHeight) {\n                // The digest is forced to calculate the height, which is not necessary when the height is knowm\n                !$scope.$$phase && $scope.$digest();\n              }\n            }\n          }\n        }\n\n        function calculateAbsoluteScroll() {\n            if(rowHeight) {\n              scPreviousScrollTop = viewport.scrollTop();\n              let newFirst = Math.floor(viewport.scrollTop() / rowHeight) + buffer.getAbsMinIndex();\n              newFirst = Math.max(buffer.getAbsMinIndex(), Math.min(buffer.getAbsMaxIndex(),newFirst)); // Bound the scroll\n              if (newFirst<buffer.first-bufferSize) {\n                return newFirst;\n              }         \n              if (newFirst>buffer.next+bufferSize) {\n                return newFirst;\n              }         \n            }\n            return undefined;\n        }\n\n        function wheelHandler(event) {\n          if (!adapter.disabled) {\n            const scrollTop = viewport[0].scrollTop;\n            const yMax = viewport[0].scrollHeight - viewport[0].clientHeight;\n\n            if ((scrollTop === 0 && !buffer.bof) || (scrollTop === yMax && !buffer.eof)) {\n              event.preventDefault();\n            }\n          }\n        }\n      }\n\n    }\n  ]);\n"],"sourceRoot":""}